<!DOCTYPE html>
<html lang="zh_cn">
  <head>
        <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=endge, chrome=IE8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no" />
    <title>Linux下 .Net 踩过的一些坑 — 君に会いたい ...Sprinter</title>
    <!--[if lte IE 8]><script type="text/javascript" src="https://jackyzy823.github.io/theme/js/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" type="text/css" href="https://jackyzy823.github.io/theme/css/skeleton.css" />
    <link rel="stylesheet" type="text/css" href="https://jackyzy823.github.io/theme/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="https://jackyzy823.github.io/theme/css/theme.css" />
    <link rel="stylesheet" media="not print" type="text/css" href="https://jackyzy823.github.io/theme/css/pygments.css" /> 
    <link rel="shortcut icon" type="image/png" href="https://jackyzy823.github.io/favicon.png" />
    <!--[if lte IE 8]><link rel="shortcut icon" type="image/x-icon" href="https://jackyzy823.github.io/favicon.ico" /><![endif]-->
    <link rel="alternate" type="application/atom+xml"
                           title="君に会いたい ...Sprinter — jackyzy823"
                           href="https://jackyzy823.github.io/feeds/all.atom.xml" />

    <meta name="author"   content="jackyzy823" />
    <meta name="keywords" content="csharp, dotnet" />
    <meta name="description" content="dotnet framework / dotnet standard / dotnet core / dotnet 傻傻分不清楚 Ref: MSDN 版本 -> 语言特性 匹配但又不完全匹配 .NetFramework4.5.2 不支持C#8.0，但如果在.csproj中加上在8.0 …"/>
    
    <meta property="og:title" content="Linux下 .Net 踩过的一些坑" />
    <meta property="og:url" content="https://jackyzy823.github.io/tech/dotnet-under-linux.html" />
    <link rel="canonical" href="https://jackyzy823.github.io/tech/dotnet-under-linux.html"/>
  </head>
  <body>
    <a name="top"></a>
    <div id="page">
      <header id="page-head">
        <h1>
          <a href="https://jackyzy823.github.io/index.html">君に会いたい ...Sprinter</a>
        </h1>
      </header>
      <div id="page-body">
        <article class="post" id="page-main" role="main">
      <header class="post-header">
        <h2>
          <a rel="bookmark"
             href="https://jackyzy823.github.io/tech/dotnet-under-linux.html"
             title="Permanent link to «Linux下 .Net 踩过的一些坑»">
             Linux下 .Net 踩过的一些坑
          </a>
        </h2>
        <div class="meta">
            Date: <time datetime="2022-09-24T00:00:00+08:00" title="2022-09-24T00:00:00+08:00">Sat 24 September 2022</time>        </div>
      </header>
      <div class="post-content"> 
        <ol>
<li>
<p>dotnet framework / dotnet standard / dotnet core / dotnet 傻傻分不清楚 Ref: <a href="https://learn.microsoft.com/en-us/dotnet/standard/frameworks">MSDN</a></p>
</li>
<li>
<p>版本 -&gt; 语言特性</p>
<p>匹配但又不完全匹配 .NetFramework4.5.2 不支持C#8.0，但如果在.csproj中加上在<langVersion>8.0</langVersion>或<langVersion>preview</langVersion>就可以使用一部分特性，可惜最好用的Range/Indices却不能用。 Ref:  <a href="https://stackoverflow.com/questions/56651472/does-c-sharp-8-support-the-net-framework">StackOverflow</a>,<a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/configure-language-version">MSDN</a></p>
</li>
<li>
<p>不使用 dotnet build/publish 命令</p>
<p>编译: dotnet /usr/lib64/dotnet/sdk/<sdk_version>/Roslyn/bincore/csc.dll 后面就是常规的CSC参数 例如 <code>-lib:/usr/lib64/dotnet/shared/Microsoft.NETCore.App/&lt;sdk_version&gt;/</code> 或 <code>-r</code></p>
<p>运行: <code>dotnet exec --runtimeconfig /usr/lib64/dotnet/sdk/&lt;sdk_version&gt;/dotnet.runtimeconfig.json &lt;exe_file&gt;</code></p>
<p>Ref: <a href="https://stackoverflow.com/questions/46065777/is-it-possible-to-compile-a-single-c-sharp-code-file-with-the-net-core-roslyn-c">StackOverflow</a></p>
</li>
<li>
<p>打包成单个文件（带运行时）</p>
<p>项目文件(.csproj)中 <PropertyGroup> 下增加</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nt">&lt;PublishSingleFile&gt;</span>true<span class="nt">&lt;/PublishSingleFile&gt;</span>
<span class="w">    </span><span class="nt">&lt;SelfContained&gt;</span>true<span class="nt">&lt;/SelfContained&gt;</span>
<span class="w">    </span><span class="nt">&lt;RuntimeIdentifier&gt;</span>linux-x64<span class="nt">&lt;/RuntimeIdentifier&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- for: Unable to find package Microsoft.NETCore.App.Runtime.linux-x64 with version (= 6.0.0-rc.2.21470.23) --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!--      NU1102:   - Found 98 version(s) in nuget.org [ Nearest version: 6.0.0-rc.2.21480.10 ] --&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- https://learn.microsoft.com/en-us/dotnet/core/project-sdk/msbuild-props#runtimeframeworkversion --&gt;</span>
<span class="w">    </span><span class="nt">&lt;RuntimeFrameworkVersion&gt;</span>6.0.9<span class="nt">&lt;/RuntimeFrameworkVersion&gt;</span>
</code></pre></div>
<p>RID(RuntimeIdentifier) Ref: <a href="https://learn.microsoft.com/en-us/dotnet/core/rid-catalog">MSDN</a></p>
<p>RuntimeFrameworkVersion是为了避免Nuget.org上下不到你SDK版本对应的运行时。</p>
</li>
<li>
<p>不想使用在线Nuget</p>
<p>项目目录下新建 nuget.config。内容：</p>
<div class="highlight"><pre><span></span><code>&lt;configuration&gt;
&lt;packageSources&gt;
&lt;clear&gt;
&lt;add key=&quot;local&quot; value=&quot;&lt;path&gt;&quot;
&lt;/packageSources&gt;
&lt;/configuration&gt;
</code></pre></div>
<p>将下载好的.nuget包放进<code>&lt;path&gt;</code></p>
</li>
<li>
<p>使用Omnisharp-Vim 如果遇到Found 0 Instance问题</p>
<ul>
<li>
<p><code>let g:OmniSharp_server_use_net6 = 1</code> 然后重装 <code>:OmniSharpInstall</code></p>
</li>
<li>
<p>如果你的sdk_version带<code>rc</code>（预览版本），新建 ~/.omnisharp/omnisharp.json</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;SDK&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;includePrereleases&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</li>
</ol>
      </div>
      <footer class="post-footer">
        <div class="meta">
            Posted in «<a href="https://jackyzy823.github.io/category/tech.html">tech</a>» 
            by <a href="https://jackyzy823.github.io/author/jackyzy823.html">jackyzy823</a><br />
              Tags:  #<a href="https://jackyzy823.github.io/tag/csharp.html">csharp</a> #<a href="https://jackyzy823.github.io/tag/dotnet.html">dotnet</a>        </div>
        <br/>
        <ul>
              <li>Prev:
                  <a href="https://jackyzy823.github.io/monthly/2022-09.html">
                      2022-09 月记
                  </a>
              </li>
              <li>Next:
                  <a href="https://jackyzy823.github.io/monthly/2022-10.html">
                      2022-10 月记
                  </a>
              </li>
         </ul>
      </footer>
      <div id="comment-post">
        <h3>Leave a comment</h3>
        <p>Note : Your comment will not be displayed until a Github PullRequest have been merged.</p>
        <noscript><p>Note2: Require Javascript to submit a comment.</p></noscript>
        <script type="text/javascript" src="https://jackyzy823.github.io/theme/js/spark-md5.min.js"></script>
        <script type="text/javascript">
            var comment = function(button){
              if ( !window.event.target.parentElement.reportValidity() ){
                return;
              }

              let keywords = ["slug" , "name" , "email" , "url" , "comment" , "replyto"];

              let payload = {};
              keywords.forEach(function(item, index) {
                  payload[item] = document.getElementById("comment-"+item).value;
              });
              payload["email"] = SparkMD5.hash(payload["email"]);
              fetch("https://publicactiontrigger.azurewebsites.net/api/dispatches/jackyzy823/jackyzy823.github.io", {
                method: 'POST',
                mode: 'cors',
                credentials: 'omit',
                cache: 'no-cache',
                redirect: 'error',
                referrerPolicy: 'no-referrer',
                body: JSON.stringify({ event_type: 'comment', client_payload: { data: payload } })
              }).then(function(resp){
                if(resp.ok){
                  document.getElementById("comment-result").textContent = "Success."
                } else if (resp.status == 422){
                  resp.text().then(
                    function(msg){
                      document.getElementById("comment-result").textContent = "Error: "+msg;
                    })
                }
              });
            }

        </script>
        <form>
            <input id="comment-slug" name="options[slug]" type="hidden" value="dotnet-under-linux">
            <p><label>Name:</label> <input id="comment-name" name="fields[name]" type="text" placeholder="(Required)" required="required"></p>
            <p><label>E-mail:</label> <input id="comment-email" name="fields[email]" type="email" placeholder="(Required to calcuate MD5 for displaying avatar)" required="required"></p>
            <p><label>Website:</label> <input id="comment-url" name="fields[url]" type="text" placeholder="(Optional)"></p>
            <p><label>Comment:</label> <textarea id="comment-comment" name="fields[comment]" rows=5 required="required"></textarea></p>
            <p><label>Reply To(<a alt="Clean replyto" onclick="document.getElementById('comment-replyto').value = null">Clear</a>):</label>
              <input id="comment-replyto" name="fields[replyto]" type="text" placeholder="(Empty if directly replying to this article)" readonly></p>
            <input type="button" value="Submit" onclick="comment()" ></input>
            <p id="comment-result"></p>
        </form>
      </div>

      </article> 
        <aside id="page-side">
          <nav>
            <h3>Pages</h3>
            <ul>
              <li><a href="https://jackyzy823.github.io/">Home</a></li>
              <li><a href="https://jackyzy823.github.io/categories.html">Categories</a></li>
              <li><a href="https://jackyzy823.github.io/archives.html">Archives</a></li>
              <li><a href="https://jackyzy823.github.io/tags.html">Tags</a></li>
              <li><a href="https://jackyzy823.github.io/about.html">About</a></li>
              <li><a href="https://jackyzy823.github.io/projects.html">Projects</a></li>
              <li><a href="https://jackyzy823.github.io/random-thoughts.html">Random Thoughts</a></li>
              <li><a href="https://jackyzy823.github.io/self-hostings.html">Self Hostings</a></li>
            </ul>
          </nav>

          <nav>
            <h3>Categories</h3>
            <ul>
              <li><a href="https://jackyzy823.github.io/category/monthly.html">monthly</a></li>
              <li><a href="https://jackyzy823.github.io/category/rambling.html">rambling</a></li>
              <li class="active"><a href="https://jackyzy823.github.io/category/tech.html">tech</a></li>
            </ul>
          </nav>

          <nav>
            <h3>Links</h3>
            <ul>
              <li><a href="https://jackyzy823.github.io/feeds/all.atom.xml">Feed(Atom)</a></li>
              <li><a href="https://github.com/jackyzy823">me@github</a></li>
              <li><a href="https://twitter.com/jackyzy823">me@twitter[NSFW]</a></li>
            </ul>
          </nav>
</aside>       </div>        <footer id="page-foot">
        <p> Powered by <a href="http://pelican.readthedocs.org">Pelican</a><br>
          Built with <a href="https://docs.github.com/en/actions">Github Actions</a><br/>
          Theme <strong>Hikaru</strong> based on <a href="https://github.com/getpelican/pelican-themes/tree/master/dev-random2">dev-random2</a> and <strong>Akai</strong> by <a href="https://www.soimort.org">Soimort</a></br/>
          Comments via <a href="https://github.com/benkaiser">benkaiser</a>'s <a href="https://github.com/apps/public-action-trigger">Public Action Trigger</a> and my <a href="https://github.com/jackyzy823/jackyzy823.github.io/tree/source/.github/workflows">workflow</a>
          </p>
          <a href="#top">Back To Top</a>
      </footer>
    </div>   </body>
</html>